' ================================================ 
'   🗓 Fecha de creación: 2025-08-03
'   🛠 Propósito: 選択フォルダからファイルを検索
'   Scripted with ❤️  by Nahoko ＆ Rodem XOXO
'   ∴ Reliable ｜ Practical ｜ a bit cheeky ∵ 
'   💻 ¡Transformando bits en arte, día y noche!
' ================================================

Option Explicit

Dim shell, folder, folderPath, searchKeyword, result, fso
Set shell = CreateObject("Shell.Application")
Set fso = CreateObject("Scripting.FileSystemObject")

' 📁 フォルダ選択ダイアログ
Set folder = shell.BrowseForFolder(0, "📁 検索するフォルダを選んでね", 0, 0)
If folder Is Nothing Then
    WScript.Echo "❌ キャンセルされました"
    WScript.Quit
End If
folderPath = folder.Self.Path

' 🔍 検索キーワード入力
searchKeyword = InputBox("🔍 検索するファイル名の一部を入力してね（例：お弁当、.xlsx）", "検索ファイル名")
If Trim(searchKeyword) = "" Then
    WScript.Echo "❌ ファイル名が未入力なので終了します"
    WScript.Quit
End If

' 検索結果を格納
result = ""

' 🔁 再帰検索実行
SearchFiles folderPath, searchKeyword

' 結果処理
If result = "" Then
    MsgBox "😿 該当ファイルが見つかりませんでした。", vbExclamation, "検索結果"
Else
    Dim tempFile, txtFile
    tempFile = fso.GetSpecialFolder(2) & "\検索結果_" & Replace(Replace(Now, "/", "-"), ":", "-") & ".txt"
    Set txtFile = fso.CreateTextFile(tempFile, True)
    txtFile.Write result
    txtFile.Close
    MsgBox "✅ 検索結果をメモ帳で開きます。" & vbCrLf & vbCrLf & tempFile, vbInformation, "完了"
    CreateObject("WScript.Shell").Run "notepad.exe """ & tempFile & """"
End If

' === 🧠 再帰ファイル検索サブルーチン ===
Sub SearchFiles(ByVal targetFolder, ByVal keyword)
    Dim file, subfolder
    For Each file In fso.GetFolder(targetFolder).Files
        If InStr(LCase(file.Name), LCase(keyword)) > 0 Then
            result = result & file.Path & vbCrLf
        End If
    Next
    For Each subfolder In fso.GetFolder(targetFolder).SubFolders
        SearchFiles subfolder.Path, keyword
    Next
End Sub
