'===============================================
'   🗓 Fecha de creación: 2025-08-03
'   🛠 Propósito: 選択フォルダからファイルを検索
'   Scripted with ❤️  by Nahoko ＆ Rodem XOXO
'   ∴ Reliable ｜ Practical ｜ a bit cheeky ∵ 
'   💻 ¡Transformando bits en arte, día y noche!
'===============================================

Option Explicit

' --- 再帰検索の処理を先に定義 ---
Sub SearchFiles(ByVal targetFolder, ByVal pattern)
    Dim folder, file, subfolder, fso
    Set fso = CreateObject("Scripting.FileSystemObject")
    For Each file In fso.GetFolder(targetFolder).Files
        If LCase(file.Name) Like LCase(pattern) Then
            result = result & file.Path & vbCrLf
        End If
    Next
    For Each subfolder In fso.GetFolder(targetFolder).SubFolders
        Call SearchFiles(subfolder.Path, pattern)
    Next
End Sub

' --- メイン処理 ---
Dim shell, folder, folderPath, searchPattern, result
Set shell = CreateObject("Shell.Application")

Set folder = shell.BrowseForFolder(0, "📁 検索するフォルダを選んでね", 0, 0)
If folder Is Nothing Then
    WScript.Echo "❌ キャンセルされました"
    WScript.Quit
End If
folderPath = folder.Self.Path

searchPattern = InputBox("🔍 検索するファイル名（例：*.txt や 予算書*.xls）を入力してね", "検索ファイル名")
If Trim(searchPattern) = "" Then
    WScript.Echo "❌ ファイル名が未入力なので終了します"
    WScript.Quit
End If

result = ""
Call SearchFiles(folderPath, searchPattern)

If result = "" Then
    MsgBox "😿 該当ファイルが見つかりませんでした。", vbExclamation, "検索結果"
Else
    Dim tempFile, fso, txtFile
    Set fso = CreateObject("Scripting.FileSystemObject")
    tempFile = fso.GetSpecialFolder(2) & "\検索結果_" & Replace(Replace(Now, "/", "-"), ":", "-") & ".txt"
    Set txtFile = fso.CreateTextFile(tempFile, True)
    txtFile.Write result
    txtFile.Close
    MsgBox "✅ 検索結果をメモ帳で開きます。" & vbCrLf & vbCrLf & tempFile, vbInformation, "完了"
    CreateObject("WScript.Shell").Run "notepad.exe """ & tempFile & """"
End If
